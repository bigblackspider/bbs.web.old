var vm = require("vm"), fs = require("fs"), assert = require("assert").ok, path = require("path");
exports.Closure = function (d) {
    function e(b) {
        var c = fs.readFileSync(path.normalize(b), "utf8");
        f(c, b);
        return !0
    }

    function f(b, c) {
        a === global ? vm.runInThisContext(b, c) : vm.runInThisContext("(function(){with(this){" + b + "\n}});", c).call(a)
    }

    var a = d || {};
    (function (b, c) {
        for (var a in c)void 0 === b[a] && (b[a] = c[a])
    })(a, {
        CLOSURE_BASE_PATH: "closure-library/closure/goog/",
        CLOSURE_IMPORT_SCRIPT: e,
        goog: {},
        window: {
            setTimeout: setTimeout,
            clearTimeout: clearTimeout,
            setInterval: setInterval,
            clearInterval: clearInterval,
            console: console
        },
        execScript: function (a) {
            f(a, "execScript");
            return null
        }
    });
    a.goog.loadScript = e;
    d = a.CLOSURE_BASE_PATH;
    assert(d.slice(-1) === path.sep, "CLOSURE_BASE_PATH must end with '" + path.sep + "'");
    e(d + "base.js");
    return a.goog
};
